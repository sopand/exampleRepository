# Session Clustering

> - 세션은 단일서버 환경에서는 문제가 되지 않지만, 로드밸런서를 통한 Scale-out된 분산 환경에서 문제가 발생한다
> - 서버 A,B가 존재할 때 사용자의 로그인 Session은 A 서버에 저장, 이후 사용자가 API 요청시 트래픽 분산으로 인해 B서버로 요청이 진행되면
    > 해당 사용자의 Session은 A 서버에 저장되어 있기 때문에 B 서버의 API 에서 인가처리를 받지못함.
> - 이러한 문제를 해결하기 한 방법으로 크게 2가지가 존재한다.
>   - **Sticky Session**
>   - **Session Clustering**

### Sticky Session 이란
> - 로드 밸런서의 설정을 통해 사용자의 요청이 처음 Session을 저장한 서버로만 가도록 설정하는 방법
> - 해당 방법은 실시간 트래픽과 상관없이 세션이 저장된 서버에 요청이 되어, 트래픽이 몰릴 수 있어 로드 밸런싱을 하는 의미가 퇴색된다.
> - 특정 서버에 장애가 발생한다면 해당 서버에 존재하는 세션이 모두 사라질 수 있다.

### Session Clustering 이란
> - 여러 WAS의 Session이 모두 공유되도록 하는 방법을 말함
> - 일반적으론 하나의 서버에 세션이 생성되면 나머지 모든 서버의 세션저장소에 같은 Session을 생성하는 방식
> - 하지만 이 방식은 서버의 수가 늘어날 수록 사용되는 비용이 커지기 때문에 또 다른 문제가 발생한다.
> - 그래서 Redis 같은 DB를 이용하여 모든 서버가 같은 Redis Session 저장소를 바라보게 하는 방법을 사용한다.
> - 간략하게 말하면 외부로 Session 저장소를 분리한 방법.

### Redis를 주로 쓰는 이유
> - Session 저장소 같은 경우 모든 인가 요청시에 사용되기 때문에 저장소의 접근이 잦다.
> - 이때 저장소가 RDB라면 디스크 I/O 작업이 많아지기 때문에 서버의 메모리 부하가 커짐.
> - 하지만 Redis는 인메모리 기반으로 디스크 I/O 작업을 하지 않기 때문에 메모리 낭비를 줄일 수 있음.
